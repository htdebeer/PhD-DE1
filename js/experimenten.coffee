
# Les 3 
#
mei_wind = """
# DEZE GEGEVENS MOGEN VRIJ WORDEN GEBRUIKT MITS DE VOLGENDE BRONVERMELDING WORDT GEGEVEN:
# KONINKLIJK NEDERLANDS METEOROLOGISCH INSTITUUT (KNMI)
# 
# 
# STN         LON        LAT          ALT NAME
# 370: 	      5.41	 51.45	     203  EINDHOVEN
# 
# YYYYMMDD = datum (YYYY=jaar,MM=maand,DD=dag); 
# HH       = tijd (HH=uur, UT.12 UT=13 MET, 14 MEZT. Uurvak 05 loopt van 04.00 UT tot 5.00 UT; 
# FH       = Uurgemiddelde windsnelheid (in 0.1 m/s); 
# 
# STN,YYYYMMDD,   HH,   FH
# 
  370,20120526,    1,   30
  370,20120526,    2,   30
  370,20120526,    3,   30
  370,20120526,    4,   30
  370,20120526,    5,   30
  370,20120526,    6,   40
  370,20120526,    7,   30
  370,20120526,    8,   30
  370,20120526,    9,   40
  370,20120526,   10,   50
  370,20120526,   11,   60
  370,20120526,   12,   60
  370,20120526,   13,   60
  370,20120526,   14,   60
  370,20120526,   15,   60
  370,20120526,   16,   50
  370,20120526,   17,   50
  370,20120526,   18,   50
  370,20120526,   19,   60
  370,20120526,   20,   40
  370,20120526,   21,   40
  370,20120526,   22,   50
  370,20120526,   23,   40
  370,20120526,   24,   30
  370,20120527,    1,   30
  370,20120527,    2,   20
  370,20120527,    3,   20
  370,20120527,    4,   20
  370,20120527,    5,   20
  370,20120527,    6,   20
  370,20120527,    7,   20
  370,20120527,    8,   20
  370,20120527,    9,   30
  370,20120527,   10,   50
  370,20120527,   11,   50
  370,20120527,   12,   40
  370,20120527,   13,   50
  370,20120527,   14,   50
  370,20120527,   15,   50
  370,20120527,   16,   40
  370,20120527,   17,   40
  370,20120527,   18,   30
  370,20120527,   19,   20
  370,20120527,   20,   30
  370,20120527,   21,   30
  370,20120527,   22,   30
  370,20120527,   23,   20
  370,20120527,   24,   10
  370,20120528,    1,   10
  370,20120528,    2,   10
  370,20120528,    3,   10
  370,20120528,    4,   10
  370,20120528,    5,   20
  370,20120528,    6,   20
  370,20120528,    7,   20
  370,20120528,    8,   20
  370,20120528,    9,   30
  370,20120528,   10,   40
  370,20120528,   11,   40
  370,20120528,   12,   40
  370,20120528,   13,   50
  370,20120528,   14,   60
  370,20120528,   15,   60
  370,20120528,   16,   50
  370,20120528,   17,   50
  370,20120528,   18,   50
  370,20120528,   19,   50
  370,20120528,   20,   30
  370,20120528,   21,   20
  370,20120528,   22,   20
  370,20120528,   23,   20
  370,20120528,   24,   20
"""
mei_temp = """
# DEZE GEGEVENS MOGEN VRIJ WORDEN GEBRUIKT MITS DE VOLGENDE BRONVERMELDING WORDT GEGEVEN:
# KONINKLIJK NEDERLANDS METEOROLOGISCH INSTITUUT (KNMI)
# 
# 
# STN         LON        LAT          ALT NAME
# 370: 	      5.41	 51.45	     203  EINDHOVEN
# 
# YYYYMMDD = datum (YYYY=jaar,MM=maand,DD=dag); 
# HH       = tijd (HH=uur, UT.12 UT=13 MET, 14 MEZT. Uurvak 05 loopt van 04.00 UT tot 5.00 UT; 
# T        = Temperatuur (in 0.1 graden Celsius) op 1.50 m hoogte tijdens de waarneming; 
# 
# STN,YYYYMMDD,   HH,    T
# 
  370,20120525,   24,  164
  370,20120526,    1,  134
  370,20120526,    2,  133
  370,20120526,    3,  144
  370,20120526,    4,  149
  370,20120526,    5,  160
  370,20120526,    6,  172
  370,20120526,    7,  193
  370,20120526,    8,  210
  370,20120526,    9,  223
  370,20120526,   10,  230
  370,20120526,   11,  235
  370,20120526,   12,  246
  370,20120526,   13,  247
  370,20120526,   14,  251
  370,20120526,   15,  250
  370,20120526,   16,  252
  370,20120526,   17,  249
  370,20120526,   18,  242
  370,20120526,   19,  232
  370,20120526,   20,  217
  370,20120526,   21,  206
  370,20120526,   22,  199
  370,20120526,   23,  188
  370,20120526,   24,  178
  370,20120527,    1,  166
  370,20120527,    2,  154
  370,20120527,    3,  130
  370,20120527,    4,  122
  370,20120527,    5,  150
  370,20120527,    6,  175
  370,20120527,    7,  204
  370,20120527,    8,  221
  370,20120527,    9,  234
  370,20120527,   10,  243
  370,20120527,   11,  251
  370,20120527,   12,  256
  370,20120527,   13,  255
  370,20120527,   14,  261
  370,20120527,   15,  260
  370,20120527,   16,  260
  370,20120527,   17,  255
  370,20120527,   18,  240
  370,20120527,   19,  233
  370,20120527,   20,  208
  370,20120527,   21,  200
  370,20120527,   22,  186
  370,20120527,   23,  171
  370,20120527,   24,  159
  370,20120528,    1,  151
  370,20120528,    2,  138
  370,20120528,    3,  133
  370,20120528,    4,  130
  370,20120528,    5,  145
  370,20120528,    6,  157
  370,20120528,    7,  175
  370,20120528,    8,  202
  370,20120528,    9,  225
  370,20120528,   10,  236
  370,20120528,   11,  239
  370,20120528,   12,  246
  370,20120528,   13,  259
  370,20120528,   14,  254
  370,20120528,   15,  252
  370,20120528,   16,  246
  370,20120528,   17,  238
  370,20120528,   18,  224
  370,20120528,   19,  205
  370,20120528,   20,  178
  370,20120528,   21,  161
  370,20120528,   22,  150
  370,20120528,   23,  136
  370,20120528,   24,  129
"""

cognac_json = '{"path":"M 346 223 c 24.5 67.75 45 103.25 37 151 c -3 29 -16 78 -118 92 l 0 62 c -4 21.25 73.5 13.75 89 29","foot":{"x":255,"y":557},"stem":{"x":255,"y":528},"bowl":{"x":255,"y":466},"edge":{"x":255,"y":223},"height_in_mm":110,"spec":{"round_max":"cl","mm_from_top":0},"measure_lines":{},"nr_of_measure_lines":0}'
bier_json = '{"path":"M 363 253 l 0 94 c 1 16.75 -3 11.25 -12 31 l -25 175 l 0 2 l 0 2","foot":{"x":255,"y":557},"stem":{"x":255,"y":555},"bowl":{"x":255,"y":553},"edge":{"x":255,"y":253},"height_in_mm":100,"spec":{"round_max":"cl","mm_from_top":0},"measure_lines":{},"nr_of_measure_lines":0}'

cognac_glas = new Glass cognac_json
bier_glas = new Glass bier_json

snelheids_bereken_tabel = (tabel_id) ->
  $height = $("##{tabel_id} input[name='height']")
  $volume = $("##{tabel_id} input[name='volume']")
  $uitkomst = $("##{tabel_id} input[name='uitkomst']")

  $("##{tabel_id} button").click ->

    # validate input
    floatregexp = /^(([1-9]\d*([.,]\d+)?)|(0.\d+))$/

    valid_height = false
    valid_vol = false
    if floatregexp.test $height.val()
      $height.addClass "valid"
      $height.removeClass "invalid"
      valid_height = true
    else
      $height.addClass "invalid"
      $height.removeClass "valid"
      $uitkomst.val '???'


    if floatregexp.test $volume.val()
      $volume.addClass "valid"
      $volume.removeClass "invalid"
      valid_vol = true
    else
      $volume.addClass "invalid"
      $volume.removeClass "valid"
      $uitkomst.val '???'

    if valid_height and valid_vol
      # if input is okay
      # compute answer
      height = parseFloat $height.val().replace(',','.')
      volume = parseFloat $volume.val().replace(',', '.')
      speed = height / volume

      if isNaN(speed) or (speed is Infinity)
        $uitkomst.val '???'
      else if speed isnt Math.round(speed)
        $uitkomst.val speed.toPrecision(4).replace('.', ',')
      else
        $uitkomst.val speed.toPrecision(1)

glas_en_grafiek = (sectionid, width, height, glass, options) ->
  paper = Raphael "#{sectionid}_paper", width, height
  filler = new Filler paper,
    0,
    0,
    glass,
    width,
    height,
    options

racebaan = (sectionid, width, height, track, options) ->
  paper = Raphael "#{sectionid}_paper", width, height
  trackracer = new TrackRacer paper,
    0,
    0,
    track,
    width,
    height,
    options

life_simulation = (sectionid, width, height, config, options) ->
  paper = Raphael "#{sectionid}_paper", width, height
  simulation = new LifeSimulator paper,
    0,
    0,
    config,
    width,
    height,
    options

glas_vergelijking = (sectionid, width, height, glazen, options) ->
  paper = Raphael "#{sectionid}_paper", width, height
  filler = new CompareFiller paper,
    0,
    0,
    glazen,
    width,
    height,
    options

glas = (sectionid, width, height, glass, options) ->
  paper = Raphael "#{sectionid}_paper", width, height
  filler = new Filler paper,
    0,
    0,
    glass,
    width,
    height,
    options

knmigrafiek = (sectionid, width, height, x_axis, y_axis, knmi_data) ->
  paper = Raphael "#{sectionid}_paper", width, height
  graph = new KNMIGrapher paper, 0, 0, width, height, x_axis, y_axis, knmi_data


toggle_klassikaal = (activiteit_id) ->
  $("##{activiteit_id} :first").click =>
    $("##{activiteit_id} section").toggle()
    $("##{activiteit_id} section:first").scrollintoview()
  $("##{activiteit_id} section").hide()

$(document).ready ->

  # cognac
  snelheids_bereken_tabel "cognac_snelheid_tabel"
  glas_en_grafiek 'cognac_snelheid', 1000, 700, cognac_glas,
    dimension: '2d'
    time: false
    graph_buttons: ['normal', 'point', 'straight', 'curve', 'remove', 'delta', 'computer', 'raster']
    editable: true
    diff_graph: false
    buttons: ['manual_diff']
    components: ['ruler', 'tap', 'graph']
    computer_graph: true
  toggle_klassikaal "cognac"

  # cognac met tijd
  snelheids_bereken_tabel "cognac_tijd_snelheid_tabel"
  glas_en_grafiek 'cognac_tijd_snelheid', 1000, 700, cognac_glas,
    dimension: '2d'
    time: true
    time_graph: true
    editable: true
    diff_graph: false
    graph_buttons: ['normal', 'point', 'straight', 'curve', 'remove', 'delta', 'computer', 'raster']
    buttons: ['manual_diff']
    components: ['ruler', 'tap', 'graph']
    computer_graph: true
  toggle_klassikaal "cognac_tijd"

  # bier
  snelheids_bereken_tabel "bier_snelheid_tabel"
  glas_en_grafiek 'bier_snelheid', 1000, 700, bier_glas,
    dimension: '2d'
    time: false
    graph_buttons: ['normal', 'point', 'straight', 'curve', 'remove', 'delta', 'computer', 'raster']
    editable: true
    diff_graph: false
    buttons: ['manual_diff']
    components: ['ruler', 'tap', 'graph']
    computer_graph: true
  toggle_klassikaal "bier"

  # racebaan
  snelheids_bereken_tabel "race_snelheid_tabel"
  racebaan "race_snelheid", 1200, 800, {
    path: "h-100a100,100,1,0,0,-100,100v200a50,50,1,0,0,50,50h100a60,60,1,1,0,0,-120h-40a80,80,0,0,1,0,-160h40l100,100a,50,50,0,0,0,0,-100h-50a10,10,0,0,1,0,-20h30a25,25,0,0,0,0,-50z"
    move_x: 250
    meter_per_pixel: 0.01
    ticks: "0.1tttttttttT"
    accelerationpath: '0.1|1,0|2.5,3|4,-2.5|5,0.1|6,-2.6|7,0|8,1|9,0|11,-2.0|11.5,2|13,-3|13.3,0|15,0.1|17'
    }, {
    }
  toggle_klassikaal "race"

  # populatie 1
  snelheids_bereken_tabel "populatie1_snelheid_tabel"
  life_simulation "populatie1_snelheid", 1200, 700, {
    width: 40
    height: 40
    initial_configuration: ['12;12', '13;12', '13;13', '14;14', '14;15', '12;15', '12;16', '13;14', '1;2', '1;1', '4;4', '15;16', '15,17', '17;18', '17;17', '3;4', '4;3', '2;2']
    speed: 50
    maximum_generation: 175
    }, {
      graph_buttons: ['normal', 'point', 'straight', 'curve', 'remove', 'delta', 'computer', 'raster']
    }
  toggle_klassikaal "populatie1"

  # populatie 2
  snelheids_bereken_tabel "populatie2_snelheid_tabel"
  life_simulation "populatie2_snelheid", 1200, 700, {
    width: 45
    height: 45
    initial_configuration: ['11;16', '13;16', '13;15', '15;14', '15;13', '15;12', '17;11', '17;12', '17;13', '18;12' ]
    speed: 50
    maximum_generation: 200
    }, {
      graph_buttons: ['normal', 'point', 'straight', 'curve', 'remove', 'delta', 'computer', 'raster']
    }
  toggle_klassikaal "populatie2"

  # weer 1
  snelheids_bereken_tabel "weer1_snelheid_tabel"
  knmigrafiek "weer1_snelheid", 500, 500, {
    label: "uren tussen 26 en 28 mei (uur)"
    quantity: "uren"
    symbol: "uur"
    tickspath: "3tL"
  }, {
    label: "temperatuur (°C)"
    quantity: "graden Celsius"
    symbol: "°C"
  }, mei_temp
  toggle_klassikaal "weer1"

  # weer 1
  snelheids_bereken_tabel "weer2_snelheid_tabel"
  knmigrafiek "weer2_snelheid", 570, 500, {
    label: "uren tussen 26 en 28 mei (uur)"
    quantity: "uren"
    symbol: "uur"
    tickspath: "3tL"
  }, {
    label: "gemiddelde windsnelheid (m/sec)"
    quantity: "gemiddelde windsnelheid"
    symbol: "m/sec"
  }, mei_wind
  toggle_klassikaal "weer2"


  $("#start").scrollintoview()

